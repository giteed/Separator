
# separator-silence.py

## Описание

`separator-silence.py` — это скрипт для тихого разрезания больших файлов на несколько частей с возможностью выбора кодировки. Каждая часть сохраняется в отдельном файле в указанной папке, и создается JSON-файл с метаданными, который хранится в специальной подпапке. Скрипт работает в "тихом" режиме, без вывода в консоль, и ведет логи для контроля за процессом разрезания.

## Логика работы

1. **Чтение исходного файла** — скрипт принимает путь к исходному файлу, который будет разделен на части.
2. **Разбиение файла** — файл делится на части определенного размера (указанного в килобайтах).
3. **Кодирование частей** — каждая часть файла кодируется в одну из поддерживаемых кодировок: `hex`, `base64`, или `base85`.
4. **Создание папки для хранения** — создаются две папки: одна для сохранения частей файла, другая — для метаданных.
5. **Сохранение частей** — каждая часть файла сохраняется в отдельный текстовый файл в папке `parts`.
6. **Создание файла метаданных** — JSON-файл с метаданными о разрезанном файле сохраняется в папке `json`.
7. **Логирование** — вся информация о процессе сохраняется в лог-файле, включая ошибки и успешное завершение процесса.

## Пример запуска

```bash
python3 separator-silence.py --input /path/to/input_file --output /path/to/output_dir --chunk-size 200 --encoding base64
```

### Параметры:

- `--input` (обязательный) — Путь к исходному файлу, который необходимо разделить на части.
  
  **Пример**: `/path/to/input_file`

- `--output` (обязательный) — Путь к директории, в которой будут сохранены части и метаданные.
  
  **Пример**: `/path/to/output_dir`

- `--chunk-size` (необязательный, по умолчанию: `200`) — Размер каждой части в килобайтах (КБ).
  
  **Пример**: `200` означает, что каждая часть файла будет иметь размер 200 КБ.

- `--encoding` (необязательный, по умолчанию: `base64`) — Способ кодирования частей файла. Поддерживаются следующие варианты:
  
  - `hex` — кодировка частей в шестнадцатеричный формат.
  - `base64` — кодировка в base64 (рекомендуется для большинства случаев).
  - `base85` — кодировка в base85.

  **Пример**: `base64`

## Пример работы

### Входные данные:

- **Исходный файл**: `input/lift_v3.safetensors` размером 100 МБ.
- **Размер части**: 200 КБ.
- **Кодировка**: `base64`.

### Запуск:

```bash
python3 separator-silence.py --input input/lift_v3.safetensors --output output --chunk-size 200 --encoding base64
```

### Логика работы:

1. Скрипт читает файл `input/lift_v3.safetensors`.
2. Разбивает файл на части размером по 200 КБ.
3. Каждая часть кодируется в `base64` и сохраняется в папку `output/lift_v3.safetensors_<хэш>/parts`.
4. В папке `output/lift_v3.safetensors_<хэш>/json` создается JSON-файл с метаданными, содержащий следующую информацию:
   - Оригинальное имя файла.
   - Размер исходного файла.
   - Количество частей.
   - Размер каждой части.
   - Метод кодирования.
   - MD5-хэш исходного файла.
   - Дата и время разрезания.
5. Лог-файл сохраняется в `logs/separator-silence.log`, где записываются все этапы выполнения, включая ошибки (если таковые были).

### Пример JSON метаданных:

Файл метаданных `lift_v3.safetensors_<хэш>.json`:

```json
{
  "file_name": "lift_v3.safetensors",
  "original_file_name": "lift_v3.safetensors",
  "original_size": 104857600,
  "part_count": 512,
  "chunk_size": 200,
  "encoding": "base64",
  "total_size": 104857600,
  "md5": "d7d6c1044255c80f9d794fd4dbb471fb",
  "elapsed_time_seconds": 5.34,
  "creation_date": "2024-10-24T13:12:05"
}
```

### Лог-файл:

```plaintext
2024-10-24 13:12:05 - INFO - Программа запущена
2024-10-24 13:12:05 - INFO - Разделение завершено. Метаданные сохранены: output/lift_v3.safetensors_<хэш>/json/lift_v3.safetensors_<хэш>.json
```

## Структура выходных данных:

```
output/
│
└── lift_v3.safetensors_<хэш>/
    ├── json/
    │   └── lift_v3.safetensors_<хэш>.json
    └── parts/
        ├── lift_v3.safetensors_<хэш>_part_001.txt
        ├── lift_v3.safetensors_<хэш>_part_002.txt
        ├── ...
        └── lift_v3.safetensors_<хэш>_part_N.txt
```

## Ошибки и логирование

- **Ошибки кодировки**: Если указана неверная кодировка (не `hex`, `base64`, или `base85`), скрипт завершится с ошибкой, записанной в лог.
- **Ошибки файловой системы**: Если файл не найден или отсутствует доступ к директории, ошибка будет записана в лог.
- **Логи**: Все события записываются в лог-файл `logs/separator-silence.log`.

## Дополнительная информация

- Если скрипт не может найти файл или директорию, он завершится с ошибкой, и об этом будет записано в лог.
- Логи ведутся в отдельный файл, что позволяет легко отслеживать состояние выполнения скрипта.

